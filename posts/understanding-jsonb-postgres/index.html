<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Understanding Jsonb Postgres | Generated Blog by Dathan capturing his random thoughts</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="I am running across how to debug data in PostgreSQL, a platform I am not familiar with. Specifically using JSONB_SET. JSONB_SET documentation is the following
jsonb_set ( target jsonb, path text[], new_value jsonb [, create_if_missing boolean ] ) → jsonb
 Returns target with the item designated by path replaced by new_value, or with new_value added if create_if_missing is true (which is the default) and the item designated by path does not exist."><meta name=generator content="Hugo 0.85.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/blog/ananke/css/main.min.css><meta property="og:title" content="Understanding Jsonb Postgres"><meta property="og:description" content="I am running across how to debug data in PostgreSQL, a platform I am not familiar with. Specifically using JSONB_SET. JSONB_SET documentation is the following
jsonb_set ( target jsonb, path text[], new_value jsonb [, create_if_missing boolean ] ) → jsonb
 Returns target with the item designated by path replaced by new_value, or with new_value added if create_if_missing is true (which is the default) and the item designated by path does not exist."><meta property="og:type" content="article"><meta property="og:url" content="https://dathan.github.io/blog/posts/understanding-jsonb-postgres/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-21T18:17:27-07:00"><meta property="article:modified_time" content="2022-06-21T18:17:27-07:00"><meta itemprop=name content="Understanding Jsonb Postgres"><meta itemprop=description content="I am running across how to debug data in PostgreSQL, a platform I am not familiar with. Specifically using JSONB_SET. JSONB_SET documentation is the following
jsonb_set ( target jsonb, path text[], new_value jsonb [, create_if_missing boolean ] ) → jsonb
 Returns target with the item designated by path replaced by new_value, or with new_value added if create_if_missing is true (which is the default) and the item designated by path does not exist."><meta itemprop=datePublished content="2022-06-21T18:17:27-07:00"><meta itemprop=dateModified content="2022-06-21T18:17:27-07:00"><meta itemprop=wordCount content="359"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Understanding Jsonb Postgres"><meta name=twitter:description content="I am running across how to debug data in PostgreSQL, a platform I am not familiar with. Specifically using JSONB_SET. JSONB_SET documentation is the following
jsonb_set ( target jsonb, path text[], new_value jsonb [, create_if_missing boolean ] ) → jsonb
 Returns target with the item designated by path replaced by new_value, or with new_value added if create_if_missing is true (which is the default) and the item designated by path does not exist."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/blog/ class="f3 fw2 hover-white no-underline white-90 dib">Generated Blog by Dathan capturing his random thoughts</a><div class="flex-l items-center"></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class=mt3><a href="https://www.facebook.com/sharer.php?u=https://dathan.github.io/blog/posts/understanding-jsonb-postgres/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a href="https://twitter.com/share?url=https://dathan.github.io/blog/posts/understanding-jsonb-postgres/&text=Understanding%20Jsonb%20Postgres" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://dathan.github.io/blog/posts/understanding-jsonb-postgres/&title=Understanding%20Jsonb%20Postgres" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 athelas mt3 mb1">Understanding Jsonb Postgres</h1><time class="f6 mv4 dib tracked" datetime=2022-06-21T18:17:27-07:00>June 21, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>I am running across how to debug data in PostgreSQL, a platform I am not familiar with. Specifically using <a href=https://www.postgresql.org/docs/13/functions-json.html>JSONB_SET</a>. JSONB_SET documentation is the following</p><p><em>jsonb_set ( target jsonb, path text[], new_value jsonb [, create_if_missing boolean ] ) → jsonb</em></p><pre><code>
Returns target with the item designated by path replaced by new_value, or with new_value added if create_if_missing is true (which is the default) and the item designated by path does not exist. All earlier steps in the path must exist, or the target is returned unchanged. As with the path oriented operators, negative integers that appear in the path count from the end of JSON arrays. If the last path step is an array index that is out of range, and create_if_missing is true, the new value is added at the beginning of the array if the index is negative, or at the end of the array if it is positive.

jsonb_set('[{&quot;f1&quot;:1,&quot;f2&quot;:null},2,null,3]', '{0,f1}', '[2,3,4]', false) → [{&quot;f1&quot;: [2, 3, 4], &quot;f2&quot;: null}, 2, null, 3]

jsonb_set('[{&quot;f1&quot;:1,&quot;f2&quot;:null},2]', '{0,f3}', '[2,3,4]') → [{&quot;f1&quot;: 1, &quot;f2&quot;: null, &quot;f3&quot;: [2, 3, 4]}, 2]
</code></pre><h2 id=the-operators>The operators</h2><table><thead><tr><th>Operator</th><th>Right Operand Type</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td>@></td><td>jsonb</td><td>Does the left JSON value contain the right JSON path/value entries at the top level?</td><td>&lsquo;{&ldquo;a&rdquo;:1, &ldquo;b&rdquo;:2}'::jsonb @> &lsquo;{&ldquo;b&rdquo;:2}'::jsonb</td></tr><tr><td>&lt;@</td><td>jsonb</td><td>Are the left JSON path/value entries contained at the top level within the right JSON value?</td><td>&lsquo;{&ldquo;b&rdquo;:2}'::jsonb &lt;@ &lsquo;{&ldquo;a&rdquo;:1, &ldquo;b&rdquo;:2}'::jsonb</td></tr><tr><td>?</td><td>text</td><td>Does the string exist as a top-level key within the JSON value?</td><td>&lsquo;{&ldquo;a&rdquo;:1, &ldquo;b&rdquo;:2}'::jsonb ? &lsquo;b&rsquo;</td></tr><tr><td>?</td><td></td><td>text[]</td><td>Do any of these array strings exist as top-level keys?</td></tr><tr><td>?&</td><td>text[]</td><td>Do all of these array strings exist as top-level keys?</td><td>&lsquo;[&ldquo;a&rdquo;, &ldquo;b&rdquo;]'::jsonb ?& array[&lsquo;a&rsquo;, &lsquo;b&rsquo;]</td></tr><tr><td></td><td></td><td></td><td>jsonb</td></tr><tr><td>-</td><td>text</td><td>Delete key/value pair or string element from left operand. Key/value pairs are matched based on their key value.</td><td>&lsquo;{&ldquo;a&rdquo;: &ldquo;b&rdquo;}'::jsonb - &lsquo;a&rsquo;</td></tr><tr><td>-</td><td>integer</td><td>Delete the array element with specified index (Negative integers count from the end). Throws an error if top level container is not an array.</td><td>&lsquo;[&ldquo;a&rdquo;, &ldquo;b&rdquo;]'::jsonb - 1</td></tr><tr><td>#-</td><td>text[]</td><td>Delete the field or element with specified path (for JSON arrays, negative integers count from the end)</td><td>&lsquo;[&ldquo;a&rdquo;, {&ldquo;b&rdquo;:1}]'::jsonb #- &lsquo;{1,b}&rsquo;</td></tr></tbody></table><h2 id=some-examples>Some examples</h2><p><a href=https://popsql.com/learn-sql/postgresql/how-to-query-a-json-column-in-postgresql>https://popsql.com/learn-sql/postgresql/how-to-query-a-json-column-in-postgresql</a></p><p><a href=https://www.postgresql.org/docs/13/functions-json.html>https://www.postgresql.org/docs/13/functions-json.html</a></p><p><a href=https://www.haselt.com/blog/working-with-postgresql-jsonb>https://www.haselt.com/blog/working-with-postgresql-jsonb</a></p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://dathan.github.io/blog/>&copy; Generated Blog by Dathan capturing his random thoughts 2022</a><div></div></div></footer></body></html>